"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[661],{44661:(f,u,r)=>{r.r(u),r.d(u,{RequestFinishSGCModule:()=>st,routes:()=>N});var m=r(91553),c=r(90086),_=r(904),g=r(28167),l=r(59112),Z=r(74383),s=r(69859),C=r(16400),q=r(82255),O=r(51382),i=r(49133),B=r(15882),G=r(47508),V=r(92070),T=r.n(V),P=r(23452),U=r(42657),t=r(83668),M=r(29),I=r(19966),J=r(39260),D=r(73205),R=r(14038),E=r(8870),b=r(98727),Y=r(66289),y=r(79851),L=r(86019),Q=r(6731);function K(a,d){1&a&&t._uU(0,"Resultados de seguimiento y cierre de la accion")}function $(a,d){if(1&a&&(t.TgZ(0,"mat-option",46),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e.name)}}function j(a,d){if(1&a&&(t.TgZ(0,"mat-option",46),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e.name)}}function W(a,d){if(1&a&&(t.TgZ(0,"mat-option",46),t._uU(1),t.qZA()),2&a){const e=d.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e.description)}}const w=function(){return{height:"400px"}};let H=(()=>{class a{constructor(e,o,n,p,h,S,x,k,F,lt){this._formBuilder=e,this._route=o,this._router=n,this._service=p,this.snackBar=h,this._cdr=S,this._coreUserService=x,this._userService=k,this._selectableService=F,this._requestService=lt,this.selectables=[],this.formControl=this._formBuilder.group({user_tracking_id:["",[i.kI.required,U.Z]],user_granted_id:["",[i.kI.required,U.Z]],tracking_date:["",[i.kI.required]],tracking_date_period_init:["",[i.kI.required]],tracking_date_period_end:["",[i.kI.required]],result_analysis:["",[i.kI.required]],objective:["",[i.kI.required]],total_review:["",[i.kI.required]],total_agree:["",[i.kI.required]],total_disagree:["",[i.kI.required]],total_fulfilment:["",[i.kI.required]],result_code:["",[i.kI.required,U.Z]],created_at:[T()().toDate(),[i.kI.required]]}),this.formControl.get("total_fulfilment").disable(),this.formControl.get("total_review").disable(),this.formControl.get("created_at").disable(),this._route.params.subscribe(A=>{this.requestId=A.id}),this.loadUsers("user_tracking_id","5"),this.loadUsers("user_granted_id","5"),this.loadSelectables("result_code","5"),this.formControl.get("total_agree").valueChanges.subscribe({next:A=>{this.autofillReview(A,this.formControl.value.total_disagree)}}),this.formControl.get("total_disagree").valueChanges.subscribe({next:A=>{this.autofillReview(this.formControl.value.total_agree,A)}}),this.loadStep5()}loadStep5(){this._service.retriveStep(5,B._.toLocaleLowerCase(),this.requestId).subscribe({next:e=>{if(0!=e.data.length){const o=e.data[0];this.formControl.get("objective").setValue(o.objective),this.formControl.get("result_analysis").setValue(o.result_analysis),this.formControl.get("result_code").setValue({description:o.result_description}),this.formControl.get("total_agree").setValue(o.total_agree),this.formControl.get("total_disagree").setValue(o.total_disagree),this.formControl.get("total_fulfilment").setValue(o.total_fulfilment),this.formControl.get("total_review").setValue(o.total_review),this.formControl.get("tracking_date").setValue(o.tracking_date),this.formControl.get("created_at").setValue(T()(o.created_at).toDate()),this.formControl.get("tracking_date_period_end").setValue(T()(o.tracking_date_period_end,"YYYY-MM-DD HH:mm:ss").toDate()),this.formControl.get("tracking_date_period_init").setValue(T()(o.tracking_date_period_init,"YYYY-MM-DD HH:mm:ss").toDate()),this.formControl.get("tracking_date").setValue(T()(o.tracking_date,"YYYY-MM-DD HH:mm:ss").toDate()),this.formControl.get("user_granted_id").setValue({name:o.user_granted_name}),this.formControl.get("user_tracking_id").setValue({name:o.user_tracking_name}),this.formControl.disable()}}})}loadUsers(e,o){this._userService.getUsers(this.getFilter(e,o)).subscribe({next:n=>{let p=[];n.data.forEach(h=>{p.push(new P.T(h)),this._cdr.detectChanges()}),this.selectables[e]=[...p]}})}onChangeFilter(e,o,n){this.inputTimeout&&clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout(()=>{o.includes("selectable")?this.loadSelectables(e,n):this.loadUsers(e,n)},500)}loadSelectables(e,o){this._selectableService.getSelectable(this.getselectableTable(e),this.getFilter(e,o)).subscribe({next:n=>{let p=[];n.data.forEach(h=>{p.push(new G.t(h)),this._cdr.detectChanges()}),this.selectables[e]=[...p]}})}autofillReview(e,o){e&&o&&(this.formControl.get("total_review").setValue(e+o),this.formControl.get("total_fulfilment").setValue(e/(e+o)*100))}getselectableTable(e){return{result_code:"result_types"}[e]}displayUser(e){return e?e.name:""}displaySelectable(e){return e?e.description:""}getFilter(e,o){return this.formControl.value[e]}submit(){if(this.formControl.valid){this.formControl.get("total_fulfilment").enable(),this.formControl.get("total_review").enable();const e=Object.assign({},this.formControl.value);e.result_code=e.result_code.code,e.user_granted_id=e.user_granted_id.id,e.user_tracking_id=e.user_tracking_id.id,e.request_id=this.requestId,this._service.completeStep({finish_request:e},5,"sgc").subscribe({next:o=>{console.log(`Correcto ${o.data}`),this._router.navigateByUrl("/request/list/sgc")},error:o=>{this.serverError()},complete:()=>{console.log("Completado")}}),console.log("Paso valido")}else this.validationError();this.formControl.get("total_fulfilment").disable(),this.formControl.get("total_review").disable()}validationError(){throw new Error("Method not implemented.")}serverError(){throw new Error("Method not implemented.")}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(i.qu),t.Y36(m.gz),t.Y36(m.F0),t.Y36(M.a),t.Y36(I.ux),t.Y36(t.sBO),t.Y36(J.K),t.Y36(D.K),t.Y36(R.o),t.Y36(E.s))},a.\u0275cmp=t.Xpm({type:a,selectors:[["request-finish"]],decls:102,vars:22,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","p-6","sm:py-8","sm:px-10","border-b","bg-card","dark:bg-transparent"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],[1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","md:text-4xl","font-extrabold","tracking-tight","leading-7","sm:leading-10","truncate"],[1,"flex-auto","p-6","sm:p-10"],[1,"max-w-6xl"],[1,"flex","flex-col","mt-8","p-8","pb-4","bg-card","rounded-2xl","shadow","overflow-hidden",3,"formGroup"],["matStepLabel",""],[1,"flex-auto","w-full","mt-5"],[1,"w-full"],[1,"w-1/3","pr-2"],["matInput","","name","tracking_date","formControlName","tracking_date",3,"matDatepicker"],["matSuffix","",3,"for"],["picker6",""],["matInput","","name","tracking_date_period_init","formControlName","tracking_date_period_init",3,"matDatepicker"],["picker7",""],["matInput","","name","tracking_date_period_end","formControlName","tracking_date_period_end",3,"matDatepicker"],["picker8",""],["name","result_analysis","formControlName","result_analysis",3,"styles"],[1,"w-full","mt-3"],[1,"w-1/5","pr-2"],["matInput","","name","objective","formControlName","objective"],["matInput","","type","number","name","total_agree","formControlName","total_agree"],["matInput","","type","number","name","total_disagree","formControlName","total_disagree"],["matInput","","type","number","name","total_review","formControlName","total_review"],["matInput","","type","number","name","total_fulfilment","formControlName","total_fulfilment"],[1,"w-2/3","pr-4"],["matInput","","name","user_tracking_id","formControlName","user_tracking_id",3,"matAutocomplete","input"],[3,"displayWith"],["auto20","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"w-1/3"],["matInput","","name","created_at","formControlName","created_at",3,"matDatepicker"],["picker10",""],["matInput","","name","user_granted_id","formControlName","user_granted_id",3,"matAutocomplete","input"],["auto21","matAutocomplete"],["matInput","","name","result_code","formControlName","result_code",3,"matAutocomplete","input"],["auto22","matAutocomplete"],[1,"flex","justify-end","mt-8"],["mat-flat-button","","type","button",1,"px-8",3,"color","click"],[3,"value"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"div"),t.TgZ(5,"a",4),t._uU(6,"Solicitud"),t.qZA(),t.qZA(),t.TgZ(7,"div",5),t._UZ(8,"mat-icon",6),t.TgZ(9,"a",7),t._uU(10,"Evaluacion"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",8),t.TgZ(12,"h2",9),t._uU(13," Evaluacion "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"div",10),t.TgZ(15,"div",11),t.TgZ(16,"form",12),t.YNc(17,K,1,0,"ng-template",13),t.TgZ(18,"div",14),t.TgZ(19,"div",15),t.TgZ(20,"mat-form-field",16),t.TgZ(21,"mat-label"),t._uU(22,"Fecha de evaluacion"),t.qZA(),t._UZ(23,"input",17),t._UZ(24,"mat-datepicker-toggle",18),t._UZ(25,"mat-datepicker",null,19),t.qZA(),t.TgZ(27,"mat-form-field",16),t.TgZ(28,"mat-label"),t._uU(29,"Desde"),t.qZA(),t._UZ(30,"input",20),t._UZ(31,"mat-datepicker-toggle",18),t._UZ(32,"mat-datepicker",null,21),t.qZA(),t.TgZ(34,"mat-form-field",16),t.TgZ(35,"mat-label"),t._uU(36,"Hasta"),t.qZA(),t._UZ(37,"input",22),t._UZ(38,"mat-datepicker-toggle",18),t._UZ(39,"mat-datepicker",null,23),t.qZA(),t.qZA(),t.TgZ(41,"div",15),t.TgZ(42,"mat-label"),t._uU(43,"Analisis de datos basado en"),t.qZA(),t._UZ(44,"quill-editor",24),t.qZA(),t.TgZ(45,"div",25),t.TgZ(46,"mat-form-field",26),t.TgZ(47,"mat-label"),t._uU(48,"Objetivo"),t.qZA(),t._UZ(49,"input",27),t.qZA(),t.TgZ(50,"mat-form-field",26),t.TgZ(51,"mat-label"),t._uU(52,"Total conformes"),t.qZA(),t._UZ(53,"input",28),t.qZA(),t.TgZ(54,"mat-form-field",26),t.TgZ(55,"mat-label"),t._uU(56,"Total no conformes"),t.qZA(),t._UZ(57,"input",29),t.qZA(),t.TgZ(58,"mat-form-field",26),t.TgZ(59,"mat-label"),t._uU(60,"Total evaluado"),t.qZA(),t._UZ(61,"input",30),t.qZA(),t.TgZ(62,"mat-form-field",26),t.TgZ(63,"mat-label"),t._uU(64,"Cumplimiento"),t.qZA(),t._UZ(65,"input",31),t.qZA(),t.qZA(),t.TgZ(66,"div",15),t.TgZ(67,"mat-form-field",32),t.TgZ(68,"mat-label"),t._uU(69,"Quien hace el seguimiento"),t.qZA(),t.TgZ(70,"input",33),t.NdJ("input",function(){return o.onChangeFilter("user_tracking_id","user","5")}),t.qZA(),t.TgZ(71,"mat-autocomplete",34,35),t.ynx(73),t.YNc(74,$,2,2,"mat-option",36),t.BQk(),t.qZA(),t.qZA(),t.TgZ(75,"mat-form-field",37),t.TgZ(76,"mat-label"),t._uU(77,"Fecha de seguimiento"),t.qZA(),t._UZ(78,"input",38),t._UZ(79,"mat-datepicker-toggle",18),t._UZ(80,"mat-datepicker",null,39),t.qZA(),t.qZA(),t.TgZ(82,"div",15),t.TgZ(83,"mat-form-field",32),t.TgZ(84,"mat-label"),t._uU(85,"Quien realiza la evalucion"),t.qZA(),t.TgZ(86,"input",40),t.NdJ("input",function(){return o.onChangeFilter("user_granted_id","user","5")}),t.qZA(),t.TgZ(87,"mat-autocomplete",34,41),t.ynx(89),t.YNc(90,j,2,2,"mat-option",36),t.BQk(),t.qZA(),t.qZA(),t.TgZ(91,"mat-form-field",37),t.TgZ(92,"mat-label"),t._uU(93,"Resultado de la evaluacion"),t.qZA(),t.TgZ(94,"input",42),t.NdJ("input",function(){return o.onChangeFilter("result_code","selectable","5")}),t.qZA(),t.TgZ(95,"mat-autocomplete",34,43),t.ynx(97),t.YNc(98,W,2,2,"mat-option",36),t.BQk(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(99,"div",44),t.TgZ(100,"button",45),t.NdJ("click",function(){return o.submit()}),t._uU(101," Publicar evaluacion "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e){const n=t.MAs(26),p=t.MAs(33),h=t.MAs(40),S=t.MAs(72),x=t.MAs(81),k=t.MAs(88),F=t.MAs(96);t.xp6(8),t.Q6J("svgIcon","heroicons_solid:chevron-right"),t.xp6(8),t.Q6J("formGroup",o.formControl),t.xp6(7),t.Q6J("matDatepicker",n),t.xp6(1),t.Q6J("for",n),t.xp6(6),t.Q6J("matDatepicker",p),t.xp6(1),t.Q6J("for",p),t.xp6(6),t.Q6J("matDatepicker",h),t.xp6(1),t.Q6J("for",h),t.xp6(6),t.Q6J("styles",t.DdM(21,w)),t.xp6(26),t.Q6J("matAutocomplete",S),t.xp6(1),t.Q6J("displayWith",o.displayUser),t.xp6(3),t.Q6J("ngForOf",o.selectables.user_tracking_id),t.xp6(4),t.Q6J("matDatepicker",x),t.xp6(1),t.Q6J("for",x),t.xp6(7),t.Q6J("matAutocomplete",k),t.xp6(1),t.Q6J("displayWith",o.displayUser),t.xp6(3),t.Q6J("ngForOf",o.selectables.user_granted_id),t.xp6(4),t.Q6J("matAutocomplete",F),t.xp6(1),t.Q6J("displayWith",o.displaySelectable),t.xp6(3),t.Q6J("ngForOf",o.selectables.result_code),t.xp6(2),t.Q6J("color","primary")}},directives:[l.Hw,i._Y,i.JL,i.sg,q.VY,g.KE,g.hX,Z.Nt,i.Fj,b.hl,i.JJ,i.u,b.nW,g.R9,b.Mq,Y.g6,i.wV,y.ZL,y.XC,L.sg,c.lW,Q.ey],encapsulation:2}),a})();var z=r(12605),X=r(42318),tt=r(44522),et=r(87444),rt=r(53402),ot=r(86428),at=r(67919),it=r(88182);const N=[{path:"",component:H}];let st=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[J.K,D.K,at.e,M.a,R.o,E.s,{provide:tt.TP,useClass:it.X,multi:!0}],imports:[[m.Bz.forChild(N),c.ot,_.p9,g.lN,l.Ps,Z.c,s.Fk,C.LD,q.T5,O.m,z.Nh,X.Ad,b.FA,Q.XK,I.ZX,y.Bb,Y.fi.forRoot({modules:{syntax:!0,toolbar:[["bold","italic","underline"],[{align:[]},{list:"ordered"},{list:"bullet"}],["clean"]]}}),rt.J,ot.o,et.AV]]}),a})()},29809:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>BaseModel});class BaseModel{constructor(f){return Object.assign(this,f),this}toJson(){return JSON.stringify(this)}fromJson(f){return JSON.parse(f)}valid(){return this._valid=!0,this.requiredFields().forEach(v=>{eval(v)||(this._valid=!1)}),this._valid}fields(){return Object.keys(this)}requiredFields(){return[]}forEach(f){this.fields().forEach(u=>{f(u,this[u])})}}},23452:(f,u,r)=>{r.d(u,{T:()=>c});var m=r(29809);class c extends m.g{}},8870:(f,u,r)=>{r.d(u,{s:()=>g});var m=r(45452),c=r(83668),_=r(44522);let g=(()=>{class l{constructor(s){this._http=s}getRequests({request_type:s,page:C=1,per_page:q=10}){return this._http.get(`${m._}/api/request?page=${C}&per_page=${q}&request_type=${s}`)}findRequest(s,C){return this._http.get(`${m._}/api/request?id=${s}&request_type=${C}`)}createRequest(s){return this._http.post(`${m._}/api/request/create`,{request:s})}}return l.\u0275fac=function(s){return new(s||l)(c.LFG(_.eN))},l.\u0275prov=c.Yz7({token:l,factory:l.\u0275fac}),l})()},73205:(f,u,r)=>{r.d(u,{K:()=>g});var m=r(45452),c=r(83668),_=r(44522);let g=(()=>{class l{constructor(s){this._http=s}getUsers(s=""){return this._http.get(`${m._}/api/user?search=${s}`)}}return l.\u0275fac=function(s){return new(s||l)(c.LFG(_.eN))},l.\u0275prov=c.Yz7({token:l,factory:l.\u0275fac}),l})()}}]);